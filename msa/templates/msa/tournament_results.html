{% extends 'msa/tournament_base.html' %}
{% block tournament_content %}
<div class="mt-4">
  {% if is_admin %}
  <div class="mb-4">
    <a
      href="{% url 'msa:tournament-results' tournament.slug %}?action=progress"
      class="px-3 py-1 border rounded hover:bg-gray-50 text-sm"
      >Generate next round</a
    >
  </div>
  <form method="post" class="mb-4">
    {% csrf_token %}
    <input type="hidden" name="action" value="rebuild_live_points" />
    <button class="px-3 py-1 border rounded text-sm">Rebuild live points</button>
  </form>
  {% endif %}
  {% for round, matches in matches_by_round.items %}
  <h3>{{ round }}</h3>
  <ul class="list-disc list-inside">
    {% for match in matches %}
    <li>
      {{ match.player1.name }} vs {{ match.player2.name }}{% if match.winner %} - Winner: {{ match.winner.name }}{% endif %}
      {% if is_admin %}
      <form method="post" class="inline ml-2">
        {% csrf_token %}
        <input type="hidden" name="action" value="match_result" />
        <input type="hidden" name="match_id" value="{{ match.id }}" />
        <label class="text-xs mr-1"
          ><input type="radio" name="winner" value="p1" />
          {{ match.player1.name }}</label
        >
        <label class="text-xs mr-1"
          ><input type="radio" name="winner" value="p2" />
          {{ match.player2.name }}</label
        >
        <input
          type="text"
          name="scoreline"
          class="border px-1 py-0.5 w-24 text-xs"
          placeholder="Score"
        />
        <button class="px-2 py-0.5 border rounded text-xs">Save</button>
      </form>
      {% endif %}
    </li>
    {% endfor %}
  </ul>
  {% empty %}
  <p>No results available.</p>
  {% endfor %}
</div>
{% endblock %}
