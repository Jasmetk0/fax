{% extends 'msa/tournament_base.html' %}
{% load static %}
{% block extra_head %}
  {{ block.super }}
  <link rel="stylesheet" href="{% static 'msa/players.css' %}">
{% endblock %}
{% block tournament_content %}
<div class="players-grid">
  <div class="card">
    <div class="card-header">
      <h2 class="card-title">Registered Players ({{ registered_entries|length }})</h2>
      <div class="badges">
        <span class="muted">Ordering: {{ ordering_registered_label }}</span>
        {% if is_admin %}
        <a href="{% url 'msa:tournament-players-add' tournament.slug %}" target="_blank" class="btn btn-primary btn-sm">Edit Players</a>
        {% endif %}
      </div>
    </div>
    <div class="card-body">
      <table class="w-full">
        <thead>
          <tr>
            <th class="text-left">#</th>
            <th class="text-left">Country</th>
            <th class="text-left">Player Name</th>
            {% if show_world_ranking %}<th class="text-left">World Ranking</th>{% endif %}
            <th class="text-left">Path to Main Draw</th>
          </tr>
        </thead>
        <tbody>
        {% for entry in registered_entries %}
          <tr>
            <td>{{ entry.entry_order }}</td>
            <td>{% if entry.player.country %}{{ entry.player.country }}{% else %}-{% endif %}</td>
            <td>{{ entry.player.name }}</td>
            {% if show_world_ranking %}
            <td>{% if entry.world_rank %}{{ entry.world_rank }}{% else %}-{% endif %}</td>
            {% endif %}
            <td>
              {{ entry.path_label }}
              {% if is_admin and entry.id %}
              <form method="post" action="{% url 'msa:tournament-player-remove' tournament.slug entry.id %}" style="display:inline">
                {% csrf_token %}
                <button type="submit" class="btn btn-danger btn-sm">Remove</button>
              </form>
              {% endif %}
            </td>
          </tr>
          {% if seed_cutoff and forloop.counter == seed_cutoff %}
          <tr><td colspan="{% if show_world_ranking %}5{% else %}4{% endif %}"><hr/></td></tr>
          {% endif %}
          {% if direct_cutoff and forloop.counter == direct_cutoff %}
          <tr><td colspan="{% if show_world_ranking %}5{% else %}4{% endif %}"><hr/></td></tr>
          {% endif %}
        {% empty %}
          <tr><td colspan="{% if show_world_ranking %}5{% else %}4{% endif %}" class="muted">No players registered.</td></tr>
        {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
  <div class="card">
    <div class="card-header">
      <h2 class="card-title">Accepted Players ({{ accepted_entries|length }})</h2>
      <div class="badges">
        <span class="muted">Ordering: {{ ordering_accepted_label }}</span>
        {% if seeds_count %}<span class="muted">Top {{ seeds_count }} seeded</span>{% endif %}
      </div>
    </div>
    <div class="card-body">
      {% for entry in accepted_entries %}
      <div class="row">
        <div class="who">
          <span class="name">{{ entry.player.name }}</span>
          <div class="badges">
            {% if entry.seed %}<span class="badge badge-seed">Seed {{ entry.seed }}</span>{% endif %}
            <span class="badge badge-type">{{ entry.entry_type }}</span>
          </div>
          {% if entry.entry_type == 'Q' or entry.entry_type == 'LL' %}
            <span class="sub">{{ entry.origin_note }}</span>
            {% if entry.origin_match %}<a href="{% url 'msa:match-edit' entry.origin_match.pk %}" class="sub">Qualifying match</a>{% endif %}
          {% endif %}
        </div>
        <div class="badges">
          {% if entry.rank or entry.points %}
          <span class="sub">{% if entry.rank %}#{{ entry.rank }}{% endif %}{% if entry.points %} Â· {{ entry.points }} pts{% endif %}</span>
          {% endif %}
          {% if is_admin %}
          <form method="post" action="{% url 'msa:tournament-player-remove' tournament.slug entry.id %}">
            {% csrf_token %}
            <button type="submit" class="btn btn-danger btn-sm">Remove</button>
          </form>
          {% endif %}
        </div>
      </div>
      {% empty %}
      <p class="muted">No players accepted.</p>
      {% endfor %}
    </div>
  </div>
</div>
{% endblock %}
