{% extends 'msa/base.html' %}
{% block msa_content %}
<div class="flex justify-between items-center mb-4">
  <h1 class="text-3xl font-semibold">Tournaments</h1>
  <div class="flex items-center space-x-2">
    <form method="get">
      <select name="season" onchange="this.form.submit()" class="bg-slate-800 text-white rounded-xl px-4 py-2">
        {% for s in seasons %}
        <option value="{{ s.id }}" {% if s == selected_season %}selected{% endif %}>{{ s.name }}</option>
        {% endfor %}
      </select>
    </form>
    {% if msa_admin_mode and user.is_staff %}
    <a href="{% url 'msa:season-create' %}" onclick="openPopup(this.href);return false;" class="bg-blue-600 hover:bg-blue-500 text-white rounded-xl px-4 py-2">Add Season</a>
    {% if selected_season %}
    <a href="{% url 'msa:season-edit' selected_season.id %}" onclick="openPopup(this.href);return false;" class="bg-blue-600 hover:bg-blue-500 text-white rounded-xl px-4 py-2">Edit</a>
    <a href="{% url 'msa:season-delete' selected_season.id %}" onclick="openPopup(this.href);return false;" class="bg-red-600 hover:bg-red-500 text-white rounded-xl px-4 py-2">Delete</a>
    {% endif %}
    {% endif %}
  </div>
</div>
{% if msa_admin_mode and user.is_staff %}
<div class="mb-4 space-x-2">
  <a href="{% url 'msa:category-create' %}{% if selected_season %}?season={{ selected_season.id }}{% endif %}" onclick="openPopup(this.href);return false;" class="bg-blue-600 hover:bg-blue-500 text-white rounded-xl px-4 py-2">Add Category</a>
  <a href="{% url 'msa:seasoncategory-create' %}{% if selected_season %}?season={{ selected_season.id }}{% endif %}" onclick="openPopup(this.href);return false;" class="bg-blue-600 hover:bg-blue-500 text-white rounded-xl px-4 py-2">Add SeasonCategory</a>
  <a href="{% url 'msa:tournament-create' %}{% if selected_season %}?season={{ selected_season.id }}{% endif %}" onclick="openPopup(this.href);return false;" class="bg-blue-600 hover:bg-blue-500 text-white rounded-xl px-4 py-2">Add Tournament</a>
</div>
{% endif %}
<table class="w-full border-collapse">
  <thead>
    <tr>
      <th class="text-left">Kategorie</th>
      <th class="text-left">Datum</th>
      <th class="text-left">Tournament Name</th>
      <th class="text-left">Lokace</th>
      {% if msa_admin_mode and user.is_staff %}<th></th>{% endif %}
    </tr>
  </thead>
  <tbody>
    {% for t in tournaments %}
    <tr class="border-t border-slate-800">
      <td>{{ t.season_category.label|default:t.category.name }}</td>
      <td>{{ t.start_date }} â€“ {{ t.end_date }}</td>
      <td><a href="{% url 'msa:tournament-detail' t.slug %}" class="text-blue-400 hover:text-blue-300">{{ t.name }}</a></td>
      <td>{{ t.venue|default:t.city }}</td>
      {% if msa_admin_mode and user.is_staff %}
      <td>
        <a href="{% url 'msa:tournament-edit' t.slug %}" onclick="openPopup(this.href);return false;">âœŽ</a>
        <a href="{% url 'msa:tournament-delete' t.slug %}" onclick="openPopup(this.href);return false;" class="text-red-500">ðŸ—‘</a>
      </td>
      {% endif %}
    </tr>
    {% empty %}
    <tr>
      <td colspan="{% if msa_admin_mode and user.is_staff %}5{% else %}4{% endif %}" class="text-center">No tournaments.</td>
    </tr>
    {% endfor %}
  </tbody>
</table>
<script>
  function openPopup(url){
    window.open(
      url,
      'msaManage',
      'width=720,height=640,toolbar=no,location=no,menubar=no,status=no,scrollbars=yes,resizable=yes'
    );
  }
</script>
{% endblock %}
