{% load msa_extras %}
<header id="msa-topbar" class="sticky top-0 z-50 bg-white/90 backdrop-blur supports-[backdrop-filter]:bg-white/70 shadow-sm transition-shadow">
  <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 h-16 flex items-center gap-6">
    <!-- Logo: zatím text, později nahradíme SVG -->
    <a href="{% url 'msa:home' %}" class="text-lg font-semibold tracking-wide text-slate-900 hover:opacity-80 focus:outline-none focus:ring-2 focus:ring-[#3A7BFF] focus:ring-offset-2 rounded-md">
      MSA
    </a>

    <!-- Primární navigace -->
    <nav class="flex items-center gap-1 sm:gap-2" aria-label="Primary" role="navigation">
      <a href="{% url 'msa:tournaments_list' %}"
         class="px-2 py-1 rounded-md text-sm font-medium transition [&.active]:text-[#3A7BFF] border-b-2 border-transparent hover:border-slate-300 focus:outline-none focus:ring-2 focus:ring-[#3A7BFF] focus:ring-offset-2 {% if request.path|startswith:'/tournaments' %}active border-[#3A7BFF] text-[#3A7BFF]{% endif %}"
         {% if request.path|startswith:'/tournaments' %}aria-current="page"{% endif %}>
        Tournaments
        <span id="live-badge"
              class="ml-1 inline-flex items-center justify-center rounded-md border border-slate-200 px-1.5 text-[11px] leading-5 text-slate-700 bg-white align-middle hidden"
              hx-get="{% url 'msa:nav_live_badge' %}"
              hx-trigger="load, every 60s"
              hx-swap="outerHTML">
          <!-- hidden default; server vrátí <span …>3</span> nebo 'hidden' když 0 -->
        </span>
      </a>
      <a href="{% url 'msa:rankings_list' %}"
         class="px-2 py-1 rounded-md text-sm font-medium transition [&.active]:text-[#3A7BFF] border-b-2 border-transparent hover:border-slate-300 focus:outline-none focus:ring-2 focus:ring-[#3A7BFF] focus:ring-offset-2 {% if request.path|startswith:'/rankings' %}active border-[#3A7BFF] text-[#3A7BFF]{% endif %}"
         {% if request.path|startswith:'/rankings' %}aria-current="page"{% endif %}>
        Rankings
      </a>
      <a href="{% url 'msa:players_list' %}"
         class="px-2 py-1 rounded-md text-sm font-medium transition [&.active]:text-[#3A7BFF] border-b-2 border-transparent hover:border-slate-300 focus:outline-none focus:ring-2 focus:ring-[#3A7BFF] focus:ring-offset-2 {% if request.path|startswith:'/players' %}active border-[#3A7BFF] text-[#3A7BFF]{% endif %}"
         {% if request.path|startswith:'/players' %}aria-current="page"{% endif %}>
        Players
      </a>

      <!-- More: přístupný dropdown -->
      <div class="relative">
        <button id="msa-more-btn"
                class="px-2 py-1 rounded-md text-sm font-medium transition border-b-2 border-transparent hover:border-slate-300 focus:outline-none focus:ring-2 focus:ring-[#3A7BFF] focus:ring-offset-2 flex items-center gap-1 {% if request.path|startswith:'/calendar' or request.path|startswith:'/media' or request.path|startswith:'/docs' %}active border-[#3A7BFF] text-[#3A7BFF]{% endif %}"
                {% if request.path|startswith:'/calendar' or request.path|startswith:'/media' or request.path|startswith:'/docs' %}aria-current="page" data-active="true"{% endif %}
                aria-haspopup="true" aria-expanded="false" aria-controls="msa-more-menu" type="button">
          More
          <svg aria-hidden="true" class="w-4 h-4"><path d="M4 6l4 4 4-4" fill="none" stroke="currentColor" stroke-width="2"/></svg>
        </button>
        <div id="msa-more-menu"
             class="hidden absolute right-0 mt-2 w-48 rounded-xl border border-slate-200 bg-white shadow-lg py-2"
             role="menu" aria-labelledby="msa-more-btn">
          <a href="{% url 'msa:calendar' %}" role="menuitem"
             class="block px-3 py-2 text-sm text-slate-700 hover:bg-slate-50 focus:bg-slate-50 focus:outline-none">Calendar</a>
          <a href="{% url 'msa:media' %}" role="menuitem"
             class="block px-3 py-2 text-sm text-slate-700 hover:bg-slate-50 focus:bg-slate-50 focus:outline-none">Media</a>
          <a href="{% url 'msa:docs' %}" role="menuitem"
             class="block px-3 py-2 text-sm text-slate-700 hover:bg-slate-50 focus:bg-slate-50 focus:outline-none">Docs</a>
        </div>
      </div>
    </nav>

    <!-- Vyhledávání: univerzální (hráči/turnaje) -->
    <div class="ml-auto">
      <form action="{% url 'msa:search' %}" method="get" role="search" class="relative">
        <!-- name="q" je důležité pro JS hotkeys a pro GET /search?q= -->
        <input type="search" name="q" placeholder="Search players, tournaments…"
               class="w-56 md:w-64 lg:w-72 xl:w-80 rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm shadow-inner placeholder:text-slate-400
                      focus:outline-none focus:ring-2 focus:ring-[#3A7BFF] focus:ring-offset-2"
               value="{{ request.GET.q|default:'' }}"
               aria-label="Search" />
      </form>
    </div>
  </div>
</header>
